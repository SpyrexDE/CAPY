[gd_scene load_steps=38 format=3 uid="uid://x60fmft43isp"]

[ext_resource type="Script" path="res://src/characters/player/Player.gd" id="2"]
[ext_resource type="PackedScene" uid="uid://bt1rjr1xcnwi6" path="res://src/hud/HUD.tscn" id="2_wo5ic"]
[ext_resource type="Texture2D" uid="uid://qqpheka7woxq" path="res://src/characters/player/animations/idle/idle.png" id="2_yhrxj"]
[ext_resource type="PackedScene" uid="uid://cyuvplxor46ru" path="res://src/levels/level02/background/ParallaxBackground.tscn" id="2_yuo6i"]
[ext_resource type="Texture2D" uid="uid://cmy6hnlvjjqua" path="res://src/shaders/ChromaticAbberationOffset.png" id="3_qjwb0"]
[ext_resource type="Texture2D" uid="uid://o05eaongwf6q" path="res://src/characters/player/animations/jump/jump.png" id="3_tvo4g"]
[ext_resource type="Texture2D" uid="uid://6s68hpgxhnxt" path="res://src/characters/player/animations/run/run.png" id="5_n57sj"]

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_d1lbb"]
radius = 29.73
height = 66.84

[sub_resource type="GDScript" id="6"]
script/source = "extends Camera2D

@export
var cHUD : Control

@export
var cPlayer : CharacterBody2D


func _input(event: InputEvent) -> void:
	if Input.is_action_just_pressed(\"zoom_in\"):
		var tween = create_tween()
		tween.tween_property(self, \"zoom\", zoom + Vector2(0.2, 0.2), 0.4).set_trans(Tween.TRANS_EXPO).set_ease(Tween.EASE_OUT)
	elif Input.is_action_just_pressed(\"zoom_out\"):
		if zoom - Vector2(0.1, 0.1) > Vector2.ZERO:
			var tween = create_tween()
			tween.tween_property(self, \"zoom\", zoom - Vector2(0.2, 0.2), 0.4).set_trans(Tween.TRANS_EXPO).set_ease(Tween.EASE_OUT)
"

[sub_resource type="Shader" id="Shader_tvs1s"]
code = "shader_type canvas_item;

uniform sampler2D offset_image;
uniform float strength = 1.0;

void fragment() {
	vec4 output = texture(SCREEN_TEXTURE, SCREEN_UV);
	
	float shift = strength * texture(offset_image, SCREEN_UV).r / 100.0;
	output.r = texture(SCREEN_TEXTURE, vec2(SCREEN_UV.x + shift, SCREEN_UV.y)).r;
	output.g = texture(SCREEN_TEXTURE, SCREEN_UV).g;
	output.b = texture(SCREEN_TEXTURE, vec2(SCREEN_UV.x - shift, SCREEN_UV.y)).b;
	
	COLOR = output;
}"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_1p8r6"]
shader = SubResource("Shader_tvs1s")
shader_param/offset_image = ExtResource("3_qjwb0")
shader_param/strength = 0.05

[sub_resource type="Shader" id="Shader_gq6ep"]
code = "shader_type canvas_item;

uniform float vignette_intensity = 0.4;
uniform float vignette_opacity : hint_range(0.0, 1.0) = 0.5;
uniform vec4 vignette_rgb = vec4(0.0, 0.0, 0.0, 1.0);

float vignette(vec2 uv){
	uv *= 1.0 - uv.xy;
	float vignette = uv.x * uv.y * 15.0;
	return pow(vignette, vignette_intensity * vignette_opacity);
}

void fragment(){
	vec4 color = texture(SCREEN_TEXTURE, SCREEN_UV);
	vec4 text = texture(TEXTURE, UV);
	
	text.rgba *= (vignette_rgb.rgba);
	text.rgba *= (1.0 - vignette(UV));
	
	COLOR = vec4((text.rgb)*color.rgb,text.a);
}"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_h4m4r"]
shader = SubResource("Shader_gq6ep")
shader_param/vignette_intensity = 0.4
shader_param/vignette_opacity = 0.2
shader_param/vignette_rgb = null

[sub_resource type="Animation" id="8"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite:frames")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [null]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite:frame")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [1]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("Sprite:modulate")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Color(1, 1, 1, 1)]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath(".:rotation_degrees")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [0.0]
}
tracks/4/type = "value"
tracks/4/imported = false
tracks/4/enabled = true
tracks/4/path = NodePath("Sprite:animation")
tracks/4/interp = 1
tracks/4/loop_wrap = true
tracks/4/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": ["jump"]
}

[sub_resource type="Animation" id="11"]
resource_name = "hit"
length = 0.5
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite:modulate")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.05, 0.1, 0.15, 0.2, 0.25, 0.3, 0.35, 0.4, 0.45, 0.5),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1),
"update": 0,
"values": [Color(1, 1, 1, 1), Color(0.988235, 0, 0, 1), Color(1, 1, 1, 1), Color(0.988235, 0, 0, 1), Color(1, 1, 1, 1), Color(0.988235, 0, 0, 1), Color(1, 1, 1, 1), Color(0.988235, 0, 0, 1), Color(1, 1, 1, 1), Color(0.988235, 0, 0, 1), Color(1, 1, 1, 1)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath(".:rotation")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.1, 0.2, 0.3, 0.4, 0.5),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1),
"update": 0,
"values": [0.0, -0.523599, 0.523599, -0.523599, 0.523599, 0.0]
}

[sub_resource type="Animation" id="7"]
resource_name = "idle"
length = 0.4
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.2),
"transitions": PackedFloat32Array(1, 1),
"update": 1,
"values": [0, 1]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite:animation")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": ["idle"]
}

[sub_resource type="Animation" id="14"]
resource_name = "jump"
length = 0.2
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.1),
"transitions": PackedFloat32Array(1, 1),
"update": 1,
"values": [0, 1]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite:animation")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": ["jump"]
}

[sub_resource type="Animation" id="Animation_4bpj0"]
resource_name = "run"
length = 0.4
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.1, 0.2, 0.3, 0.4),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3, 4]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite:animation")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [&"run"]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_kod1h"]
_data = {
"RESET": SubResource("8"),
"hit": SubResource("11"),
"idle": SubResource("7"),
"jump": SubResource("14"),
"run": SubResource("Animation_4bpj0")
}

[sub_resource type="AnimationNodeOneShot" id="12"]

[sub_resource type="AnimationNodeTransition" id="17"]
input_count = 3
input_0/name = "idle"
input_0/auto_advance = false
input_1/name = "jump"
input_1/auto_advance = false
input_2/name = "run"
input_2/auto_advance = false

[sub_resource type="AnimationNodeAnimation" id="13"]
animation = &"hit"

[sub_resource type="AnimationNodeAnimation" id="9"]
animation = &"idle"

[sub_resource type="AnimationNodeAnimation" id="16"]
animation = &"jump"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_lcy3m"]
animation = &"run"

[sub_resource type="AnimationNodeBlendTree" id="10"]
graph_offset = Vector2(-998.915, 249.504)
nodes/OneShot/node = SubResource("12")
nodes/OneShot/position = Vector2(288, 144)
nodes/State/node = SubResource("17")
nodes/State/position = Vector2(-128, 144)
nodes/hit/node = SubResource("13")
nodes/hit/position = Vector2(80, 240)
nodes/idle/node = SubResource("9")
nodes/idle/position = Vector2(-528, 128)
nodes/jump/node = SubResource("16")
nodes/jump/position = Vector2(-528, 240)
nodes/null/node = SubResource("AnimationNodeAnimation_lcy3m")
nodes/null/position = Vector2(-528, 368)
nodes/output/position = Vector2(512, 144)
node_connections = [&"output", 0, &"OneShot", &"OneShot", 0, &"State", &"OneShot", 1, &"hit", &"State", 0, &"idle", &"State", 1, &"jump", &"State", 2, &"null"]

[sub_resource type="AtlasTexture" id="AtlasTexture_y5lfs"]
atlas = ExtResource("2_yhrxj")
region = Rect2(0, 0, 500, 500)

[sub_resource type="AtlasTexture" id="AtlasTexture_ba7b3"]
atlas = ExtResource("2_yhrxj")
region = Rect2(500, 0, 500, 500)

[sub_resource type="AtlasTexture" id="AtlasTexture_45nio"]
atlas = ExtResource("5_n57sj")
region = Rect2(0, 0, 551, 594)

[sub_resource type="AtlasTexture" id="AtlasTexture_ixyau"]
atlas = ExtResource("5_n57sj")
region = Rect2(551, 0, 551, 594)

[sub_resource type="AtlasTexture" id="AtlasTexture_vawrw"]
atlas = ExtResource("5_n57sj")
region = Rect2(1102, 0, 551, 594)

[sub_resource type="AtlasTexture" id="AtlasTexture_mgngq"]
atlas = ExtResource("5_n57sj")
region = Rect2(1653, 0, 551, 594)

[sub_resource type="AtlasTexture" id="AtlasTexture_tubwq"]
atlas = ExtResource("5_n57sj")
region = Rect2(2204, 0, 551, 594)

[sub_resource type="AtlasTexture" id="AtlasTexture_a8h83"]
atlas = ExtResource("5_n57sj")
region = Rect2(2755, 0, 551, 594)

[sub_resource type="AtlasTexture" id="AtlasTexture_5660h"]
atlas = ExtResource("3_tvo4g")
region = Rect2(0, 0, 500, 500)

[sub_resource type="AtlasTexture" id="AtlasTexture_oed46"]
atlas = ExtResource("3_tvo4g")
region = Rect2(500, 0, 500, 500)

[sub_resource type="SpriteFrames" id="SpriteFrames_82q65"]
animations = [{
"frames": [SubResource("AtlasTexture_y5lfs"), SubResource("AtlasTexture_ba7b3")],
"loop": true,
"name": &"idle",
"speed": 5.0
}, {
"frames": [SubResource("AtlasTexture_45nio"), SubResource("AtlasTexture_ixyau"), SubResource("AtlasTexture_vawrw"), SubResource("AtlasTexture_mgngq"), SubResource("AtlasTexture_tubwq"), SubResource("AtlasTexture_a8h83")],
"loop": true,
"name": &"run",
"speed": 5.0
}, {
"frames": [SubResource("AtlasTexture_5660h"), SubResource("AtlasTexture_oed46")],
"loop": true,
"name": &"jump",
"speed": 5.0
}]

[node name="Player" type="CharacterBody2D" node_paths=PackedStringArray("cJumpTimer", "cAnimationTree", "cCamera2D")]
script = ExtResource("2")
cJumpTimer = NodePath("JumpTimer")
cAnimationTree = NodePath("AnimationTree")
cCamera2D = NodePath("Camera2D")

[node name="JumpTimer" type="Timer" parent="."]
one_shot = true

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2(5.591, 1)
rotation = 1.5708
shape = SubResource("CapsuleShape2D_d1lbb")

[node name="Camera2D" type="Camera2D" parent="." node_paths=PackedStringArray("cHUD", "cPlayer")]
current = true
zoom = Vector2(1.3, 1.3)
limit_smoothed = true
smoothing_enabled = true
smoothing_speed = 6.0
editor_draw_limits = true
script = SubResource("6")
cHUD = NodePath("CanvasLayer/HUD")
cPlayer = NodePath("..")

[node name="ParallaxBackground" parent="Camera2D" instance=ExtResource("2_yuo6i")]

[node name="PostProcessing" type="CanvasLayer" parent="Camera2D"]

[node name="ChromaticAberration" type="ColorRect" parent="Camera2D/PostProcessing"]
material = SubResource("ShaderMaterial_1p8r6")
anchor_right = 1.0
anchor_bottom = 1.0

[node name="Vignette" type="ColorRect" parent="Camera2D/PostProcessing"]
material = SubResource("ShaderMaterial_h4m4r")
anchor_right = 1.0
anchor_bottom = 1.0

[node name="CanvasLayer" type="CanvasLayer" parent="Camera2D"]

[node name="HUD" parent="Camera2D/CanvasLayer" instance=ExtResource("2_wo5ic")]

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
reset_on_save = false
libraries = {
"": SubResource("AnimationLibrary_kod1h")
}

[node name="AnimationTree" type="AnimationTree" parent="."]
tree_root = SubResource("10")
anim_player = NodePath("../AnimationPlayer")
parameters/OneShot/active = false
parameters/State/current = 0

[node name="Sprite" type="AnimatedSprite2D" parent="."]
scale = Vector2(0.2, 0.2)
frames = SubResource("SpriteFrames_82q65")
animation = &"run"

[connection signal="timeout" from="JumpTimer" to="." method="_on_JumpTimer_timeout"]
